"""
–¢–µ—Å—Ç —É–ª—å—Ç—Ä–∞-–ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
"""

import sys
import os
sys.path.append('backend')

import json
import re

def load_kb_data():
    """–ó–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π"""
    try:
        with open('backend/kb.json', 'r', encoding='utf-8') as f:
            return json.load(f)
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ kb.json: {e}")
        return None

def test_ultra_advanced_search():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç —É–ª—å—Ç—Ä–∞-–ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –ø–æ–∏—Å–∫"""
    print("üöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –£–õ–¨–¢–†–ê-–ü–†–û–î–í–ò–ù–£–¢–û–ì–û –ø–æ–∏—Å–∫–∞")
    print("=" * 60)
    
    kb_data = load_kb_data()
    if not kb_data:
        return
    
    # –≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ —Å–ª–æ–∂–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã
    test_queries = [
        # –î–æ—Å—Ç–∞–≤–∫–∞ - –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
        "–¥–æ—Å—Ç–∞–≤–∫–∞", "–¥–æ—Å—Ç–∞–≤–∫–∏", "–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å", "–¥–æ—Å—Ç–∞–≤—â–∏–∫", "–¥–æ—Å—Ç–∞–≤—â–∏—Ü–∞",
        "–ø–µ—Ä–µ–¥–æ—Å—Ç–∞–≤–∫–∞", "–ø–æ–¥–¥–æ—Å—Ç–∞–≤–∫–∞", "–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ", "–¥–æ—Å—Ç–∞–≤–ª—è–µ–º—ã–π",
        "–∫—É—Ä—å–µ—Ä", "–∫—É—Ä—å–µ—Ä—Å–∫–∞—è", "–ø–æ—Å—ã–ª–∫–∞", "–ø–µ—Ä–µ–≤–æ–∑–∫–∞", "—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞",
        "–≥—Ä—É–∑", "–≥—Ä—É–∑–æ–ø–µ—Ä–µ–≤–æ–∑–∫–∞", "–ª–æ–≥–∏—Å—Ç–∏–∫–∞", "–æ—Ç–ø—Ä–∞–≤–∫–∞", "–ø–æ–ª—É—á–µ–Ω–∏–µ",
        
        # –¶–µ–Ω–∞ - –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
        "—Ü–µ–Ω–∞", "—Ü–µ–Ω—ã", "—Ü–µ–Ω—É", "—Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ", "–ø–µ—Ä–µ–æ—Ü–µ–Ω–∫–∞",
        "—Å—Ç–æ–∏–º–æ—Å—Ç—å", "—Ç–∞—Ä–∏—Ñ", "—Ä–∞—Å—Ü–µ–Ω–∫–∞", "–ø—Ä–∞–π—Å", "–ø—Ä–µ–π—Å–∫—É—Ä–∞–Ω—Ç",
        "—Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å", "—Å—Ç–æ–∏—Ç", "—Å—Ç–æ–∏—Ç—å", "–ø–ª–∞—Ç–∞", "–æ–ø–ª–∞—Ç–∞",
        
        # –ö–∞—Ä—Ç–∞ - –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
        "–∫–∞—Ä—Ç–∞", "–∫–∞—Ä—Ç—ã", "–∫–∞—Ä—Ç–æ—á–∫–∞", "–ø–ª–∞—Å—Ç–∏–∫", "–ø–ª–∞—Ç–µ–∂",
        "–±–∞–Ω–∫–æ–≤—Å–∫–∞—è", "–∫—Ä–µ–¥–∏—Ç–∫–∞", "–¥–µ–±–µ—Ç–∫–∞", "—Å–±–µ—Ä–±–∞–Ω–∫", "visa",
        
        # –ë–∞–ª–∞–Ω—Å - –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
        "–±–∞–ª–∞–Ω—Å", "–±–∞–ª–∞–Ω—Å—ã", "–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞", "–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞—Ç—å",
        "—Å—á–µ—Ç", "—Å—á–µ—Ç–∞", "–¥–µ–Ω—å–≥–∏", "—Å—Ä–µ–¥—Å—Ç–≤–∞", "–∫–∞–ø–∏—Ç–∞–ª",
        "–Ω–∞–ª–∏—á–∫–∞", "–Ω–∞–ª–∏—á–Ω—ã–µ", "–∫–æ–ø–µ–π–∫–∏", "—Ä—É–±–ª–∏", "—Ç–µ–Ω–≥–µ",
        
        # –í–æ–¥–∏—Ç–µ–ª—å - –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
        "–≤–æ–¥–∏—Ç–µ–ª—å", "–≤–æ–¥–∏—Ç–µ–ª–∏", "–≤–æ–¥–∏—Ç–µ–ª—å–Ω–∏—Ü–∞", "–≤–æ–¥–∏—Ç—å", "–≤–æ–¥–∏—Ç",
        "—à–æ—Ñ–µ—Ä", "—Ç–∞–∫—Å–∏—Å—Ç", "–ø–µ—Ä–µ–≤–æ–∑—á–∏–∫", "–º–∞—à–∏–Ω–∏—Å—Ç", "—É–ø—Ä–∞–≤–ª—è—é—â–∏–π",
        
        # –ó–∞–∫–∞–∑ - –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
        "–∑–∞–∫–∞–∑", "–∑–∞–∫–∞–∑—ã", "–∑–∞–∫–∞–∑—ã–≤–∞—Ç—å", "–∑–∞–∫–∞–∑—á–∏–∫", "–∑–∞–∫–∞–∑—á–∏—Ü–∞",
        "–ø–æ–∫—É–ø–∫–∞", "–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ", "—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ", "—Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ",
        
        # –°–ª–æ–∂–Ω—ã–µ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
        "–∫–∞–∫ —Å–¥–µ–ª–∞—Ç—å –¥–æ—Å—Ç–∞–≤–∫—É –ø–æ—Å—ã–ª–∫–∏",
        "—Å–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç –∫—É—Ä—å–µ—Ä—Å–∫–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞",
        "–≥–¥–µ –∑–∞–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏—Å—Ç–∏–∫—É –≥—Ä—É–∑–∞",
        "–∫–∞–∫ –ø—Ä–∏–≤—è–∑–∞—Ç—å –±–∞–Ω–∫–æ–≤—Å–∫—É—é –∫–∞—Ä—Ç–æ—á–∫—É",
        "—Å–∫–æ–ª—å–∫–æ –¥–µ–Ω–µ–≥ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ –∫–∞—Ä—Ç—ã",
        "–≥–¥–µ –º–æ–π –≤–æ–¥–∏—Ç–µ–ª—å —Ç–∞–∫—Å–∏—Å—Ç–∞",
        "–∫–∞–∫ –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑ –ø–æ–∫—É–ø–∫–∏",
        "—á–µ —Ç–∞–º –ø–æ –¥–æ—Å—Ç–∞–≤–∫–µ –≥—Ä—É–∑–∞",
        "–¥–æ—Å—Ç–∞–≤–≥–∫–∞", "–¥–æ—Å—Ç–∞–≤–≥–∫–∏",  # –û–ø–µ—á–∞—Ç–∫–∏
        "—Ü–µ–Ω—ã", "—Ü–µ–Ω—É", "—Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ",  # –ú–æ—Ä—Ñ–æ–ª–æ–≥–∏—è
        "–∫–∞—Ä—Ç—ã", "–∫–∞—Ä—Ç–æ—á–∫–∏", "–ø–ª–∞—Å—Ç–∏–∫–∏",  # –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —á–∏—Å–ª–æ
    ]
    
    print(f"–¢–µ—Å—Ç–∏—Ä—É–µ–º {len(test_queries)} —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:")
    print()
    
    success_count = 0
    for i, query in enumerate(test_queries, 1):
        print(f"{i:2d}. –ó–∞–ø—Ä–æ—Å: '{query}'")
        
        # –ó–¥–µ—Å—å –±—É–¥–µ—Ç –≤—ã–∑–æ–≤ —É–ª—É—á—à–µ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–∏—Å–∫–∞
        # –ü–æ–∫–∞ —á—Ç–æ —Å–∏–º—É–ª–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        if any(word in query.lower() for word in ['–¥–æ—Å—Ç–∞–≤', '—Ü–µ–Ω', '–∫–∞—Ä—Ç', '–±–∞–ª–∞–Ω—Å', '–≤–æ–¥–∏—Ç–µ–ª', '–∑–∞–∫–∞–∑']):
            print(f"    ‚úÖ –ù–ê–ô–î–ï–ù–û! (—Å–∏–º—É–ª—è—Ü–∏—è)")
            success_count += 1
        else:
            print(f"    ‚ùå –ù–ï –ù–ê–ô–î–ï–ù–û (—Å–∏–º—É–ª—è—Ü–∏—è)")
        
        print()
    
    success_rate = (success_count / len(test_queries)) * 100
    print("üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´:")
    print(f"–£—Å–ø–µ—à–Ω–æ –Ω–∞–π–¥–µ–Ω–æ: {success_count}/{len(test_queries)} ({success_rate:.1f}%)")
    
    if success_rate >= 95:
        print("üéâ –ù–ï–í–ï–†–û–Ø–¢–ù–û! –£–ª—å—Ç—Ä–∞-–ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –ø–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ!")
    elif success_rate >= 90:
        print("üöÄ –ü–†–ï–í–û–°–•–û–î–ù–û! –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –ø–æ–∏—Å–∫–∞!")
    elif success_rate >= 80:
        print("‚úÖ –û–¢–õ–ò–ß–ù–û! –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è!")
    else:
        print("‚ùå –ù—É–∂–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è!")

if __name__ == "__main__":
    test_ultra_advanced_search()
