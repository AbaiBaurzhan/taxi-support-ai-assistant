#!/bin/bash

# üöÄ –î–µ–ø–ª–æ–π –ø—Ä–æ–µ–∫—Ç–∞ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
# –ê–≤—Ç–æ—Ä: AI Assistant
# –î–∞—Ç–∞: $(date '+%Y-%m-%d %H:%M:%S')

echo "üöÄ –ù–ê–ß–ò–ù–ê–ï–ú –î–ï–ü–õ–û–ô –ü–†–û–ï–ö–¢–ê –° –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï–ú –ö–ê–ñ–î–û–ì–û –≠–õ–ï–ú–ï–ù–¢–ê –ë–ê–ó–´ –ó–ù–ê–ù–ò–ô"
echo "================================================================================="

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
if [ ! -f "backend/main.py" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: —Ñ–∞–π–ª backend/main.py –Ω–µ –Ω–∞–π–¥–µ–Ω. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞."
    exit 1
fi

# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
echo "üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã..."
pkill -f "python3 main.py" 2>/dev/null || true
sleep 2

# –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
echo "üîß –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ..."
source venv_deploy/bin/activate

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å git
echo "üìã –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å Git..."
git status

# –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ —Ñ–∞–π–ª—ã
echo "üìÅ –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ —Ñ–∞–π–ª—ã –≤ Git..."
git add .

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –∫–æ–º–º–∏—Ç–∞
if git diff --staged --quiet; then
    echo "‚ÑπÔ∏è  –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫–æ–º–º–∏—Ç–∞."
else
    echo "üíæ –°–æ–∑–¥–∞–µ–º –∫–æ–º–º–∏—Ç —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è..."
    git commit -m "üß™ –î–æ–±–∞–≤–ª–µ–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π

‚ú® –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
- –°–æ–∑–¥–∞–Ω test_individual_kb_items.py –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞ –∏ –≤–∞—Ä–∏–∞—Ü–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –¥–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç INDIVIDUAL_KB_TEST_REPORT.md
- –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ individual_kb_test_results.json

üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
- –í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤: 245
- –£—Å–ø–µ—à–Ω—ã—Ö: 171 (69.8%)
- –í–∞—Ä–∏–∞—Ü–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤: 91.4% —É—Å–ø–µ—Ö–∞
- –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞: 35.1% —É—Å–ø–µ—Ö–∞

üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–º –∑–∞–∫–∞–∑–æ–º (100% —É—Å–ø–µ—Ö–∞)
- –£–ª—É—á—à–µ–Ω–∞ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–Ω—Ç–µ–Ω—Ç–æ–≤
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã HTTP 500 –æ—à–∏–±–∫–∏ –≤ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö

üìà –õ—É—á—à–∏–µ FAQ –ø–æ —Ç–æ—á–Ω–æ—Å—Ç–∏:
1. –¢–∞—Ä–∏—Ñ –ö–æ–º—Ñ–æ—Ä—Ç: 95.2%
2. –ß—Ç–æ —Ç–∞–∫–æ–µ –¥–æ—Å—Ç–∞–≤–∫–∞: 89.5%
3. –ß—Ç–æ —Ç–∞–∫–æ–µ –Ω–∞—Ü–µ–Ω–∫–∞: 80.0%

‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –æ–±–ª–∞—Å—Ç–∏ —Ç—Ä–µ–±—É—é—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏:
- –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ —Ä–∞–±–æ—Ç–∞—é—Ç —Ö—É–∂–µ –≤–∞—Ä–∏–∞—Ü–∏–π –≤–æ–ø—Ä–æ—Å–æ–≤
- –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –º–µ–∂–¥—É FAQ
- –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã"
fi

# –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ GitHub
echo "üöÄ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ GitHub..."
git push origin main

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
if [ $? -eq 0 ]; then
    echo ""
    echo "üéâ –î–ï–ü–õ–û–ô –£–°–ü–ï–®–ù–û –ó–ê–í–ï–†–®–ï–ù!"
    echo "================================================================================="
    echo "üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π:"
    echo "   ‚Ä¢ –í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤: 245"
    echo "   ‚Ä¢ –£—Å–ø–µ—à–Ω—ã—Ö: 171 (69.8%)"
    echo "   ‚Ä¢ –í–∞—Ä–∏–∞—Ü–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤: 91.4% —É—Å–ø–µ—Ö–∞ ‚úÖ"
    echo "   ‚Ä¢ –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞: 35.1% —É—Å–ø–µ—Ö–∞ ‚ö†Ô∏è"
    echo ""
    echo "üèÜ –õ—É—á—à–∏–µ FAQ –ø–æ —Ç–æ—á–Ω–æ—Å—Ç–∏:"
    echo "   1. –¢–∞—Ä–∏—Ñ –ö–æ–º—Ñ–æ—Ä—Ç: 95.2%"
    echo "   2. –ß—Ç–æ —Ç–∞–∫–æ–µ –¥–æ—Å—Ç–∞–≤–∫–∞: 89.5%"
    echo "   3. –ß—Ç–æ —Ç–∞–∫–æ–µ –Ω–∞—Ü–µ–Ω–∫–∞: 80.0%"
    echo ""
    echo "‚ö†Ô∏è –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:"
    echo "   ‚Ä¢ –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ —Ä–∞–±–æ—Ç–∞—é—Ç —Ö—É–∂–µ –≤–∞—Ä–∏–∞—Ü–∏–π –≤–æ–ø—Ä–æ—Å–æ–≤"
    echo "   ‚Ä¢ –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –º–µ–∂–¥—É FAQ"
    echo "   ‚Ä¢ –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã"
    echo ""
    echo "üìÑ –û—Ç—á–µ—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã:"
    echo "   ‚Ä¢ INDIVIDUAL_KB_TEST_REPORT.md - –¥–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç"
    echo "   ‚Ä¢ individual_kb_test_results.json - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"
    echo "   ‚Ä¢ test_individual_kb_items.py - —Å–∫—Ä–∏–ø—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"
    echo ""
    echo "üîó GitHub: https://github.com/[username]/Aparu"
    echo "================================================================================="
else
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –Ω–∞ GitHub. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞."
    exit 1
fi

echo "‚úÖ –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ!"
