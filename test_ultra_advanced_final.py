"""
–§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç —É–ª—å—Ç—Ä–∞-–ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
"""

import requests
import json

def test_ultra_advanced_search():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç —É–ª—å—Ç—Ä–∞-–ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ API"""
    print("üöÄ –§–ò–ù–ê–õ–¨–ù–´–ô –¢–ï–°–¢ –£–õ–¨–¢–†–ê-–ü–†–û–î–í–ò–ù–£–¢–û–ì–û –ü–û–ò–°–ö–ê")
    print("=" * 60)
    
    base_url = "http://localhost:8000"
    
    # –≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ —Å–ª–æ–∂–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã
    test_queries = [
        # –î–æ—Å—Ç–∞–≤–∫–∞ - –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
        "–¥–æ—Å—Ç–∞–≤–∫–∞", "–¥–æ—Å—Ç–∞–≤–∫–∏", "–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å", "–¥–æ—Å—Ç–∞–≤—â–∏–∫", "–¥–æ—Å—Ç–∞–≤—â–∏—Ü–∞",
        "–ø–µ—Ä–µ–¥–æ—Å—Ç–∞–≤–∫–∞", "–ø–æ–¥–¥–æ—Å—Ç–∞–≤–∫–∞", "–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ", "–¥–æ—Å—Ç–∞–≤–ª—è–µ–º—ã–π",
        "–∫—É—Ä—å–µ—Ä", "–∫—É—Ä—å–µ—Ä—Å–∫–∞—è", "–ø–æ—Å—ã–ª–∫–∞", "–ø–µ—Ä–µ–≤–æ–∑–∫–∞", "—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞",
        "–≥—Ä—É–∑", "–≥—Ä—É–∑–æ–ø–µ—Ä–µ–≤–æ–∑–∫–∞", "–ª–æ–≥–∏—Å—Ç–∏–∫–∞", "–æ—Ç–ø—Ä–∞–≤–∫–∞", "–ø–æ–ª—É—á–µ–Ω–∏–µ",
        
        # –¶–µ–Ω–∞ - –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
        "—Ü–µ–Ω–∞", "—Ü–µ–Ω—ã", "—Ü–µ–Ω—É", "—Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ", "–ø–µ—Ä–µ–æ—Ü–µ–Ω–∫–∞",
        "—Å—Ç–æ–∏–º–æ—Å—Ç—å", "—Ç–∞—Ä–∏—Ñ", "—Ä–∞—Å—Ü–µ–Ω–∫–∞", "–ø—Ä–∞–π—Å", "–ø—Ä–µ–π—Å–∫—É—Ä–∞–Ω—Ç",
        "—Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å", "—Å—Ç–æ–∏—Ç", "—Å—Ç–æ–∏—Ç—å", "–ø–ª–∞—Ç–∞", "–æ–ø–ª–∞—Ç–∞",
        
        # –ö–∞—Ä—Ç–∞ - –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
        "–∫–∞—Ä—Ç–∞", "–∫–∞—Ä—Ç—ã", "–∫–∞—Ä—Ç–æ—á–∫–∞", "–ø–ª–∞—Å—Ç–∏–∫", "–ø–ª–∞—Ç–µ–∂",
        "–±–∞–Ω–∫–æ–≤—Å–∫–∞—è", "–∫—Ä–µ–¥–∏—Ç–∫–∞", "–¥–µ–±–µ—Ç–∫–∞", "—Å–±–µ—Ä–±–∞–Ω–∫", "visa",
        
        # –ë–∞–ª–∞–Ω—Å - –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
        "–±–∞–ª–∞–Ω—Å", "–±–∞–ª–∞–Ω—Å—ã", "–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞", "–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞—Ç—å",
        "—Å—á–µ—Ç", "—Å—á–µ—Ç–∞", "–¥–µ–Ω—å–≥–∏", "—Å—Ä–µ–¥—Å—Ç–≤–∞", "–∫–∞–ø–∏—Ç–∞–ª",
        "–Ω–∞–ª–∏—á–∫–∞", "–Ω–∞–ª–∏—á–Ω—ã–µ", "–∫–æ–ø–µ–π–∫–∏", "—Ä—É–±–ª–∏", "—Ç–µ–Ω–≥–µ",
        
        # –í–æ–¥–∏—Ç–µ–ª—å - –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
        "–≤–æ–¥–∏—Ç–µ–ª—å", "–≤–æ–¥–∏—Ç–µ–ª–∏", "–≤–æ–¥–∏—Ç–µ–ª—å–Ω–∏—Ü–∞", "–≤–æ–¥–∏—Ç—å", "–≤–æ–¥–∏—Ç",
        "—à–æ—Ñ–µ—Ä", "—Ç–∞–∫—Å–∏—Å—Ç", "–ø–µ—Ä–µ–≤–æ–∑—á–∏–∫", "–º–∞—à–∏–Ω–∏—Å—Ç", "—É–ø—Ä–∞–≤–ª—è—é—â–∏–π",
        
        # –ó–∞–∫–∞–∑ - –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
        "–∑–∞–∫–∞–∑", "–∑–∞–∫–∞–∑—ã", "–∑–∞–∫–∞–∑—ã–≤–∞—Ç—å", "–∑–∞–∫–∞–∑—á–∏–∫", "–∑–∞–∫–∞–∑—á–∏—Ü–∞",
        "–ø–æ–∫—É–ø–∫–∞", "–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ", "—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ", "—Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ",
        
        # –°–ª–æ–∂–Ω—ã–µ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
        "–∫–∞–∫ —Å–¥–µ–ª–∞—Ç—å –¥–æ—Å—Ç–∞–≤–∫—É –ø–æ—Å—ã–ª–∫–∏",
        "—Å–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç –∫—É—Ä—å–µ—Ä—Å–∫–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞",
        "–≥–¥–µ –∑–∞–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏—Å—Ç–∏–∫—É –≥—Ä—É–∑–∞",
        "–∫–∞–∫ –ø—Ä–∏–≤—è–∑–∞—Ç—å –±–∞–Ω–∫–æ–≤—Å–∫—É—é –∫–∞—Ä—Ç–æ—á–∫—É",
        "—Å–∫–æ–ª—å–∫–æ –¥–µ–Ω–µ–≥ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ –∫–∞—Ä—Ç—ã",
        "–≥–¥–µ –º–æ–π –≤–æ–¥–∏—Ç–µ–ª—å —Ç–∞–∫—Å–∏—Å—Ç–∞",
        "–∫–∞–∫ –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑ –ø–æ–∫—É–ø–∫–∏",
        "—á–µ —Ç–∞–º –ø–æ –¥–æ—Å—Ç–∞–≤–∫–µ –≥—Ä—É–∑–∞",
        "–¥–æ—Å—Ç–∞–≤–≥–∫–∞", "–¥–æ—Å—Ç–∞–≤–≥–∫–∏",  # –û–ø–µ—á–∞—Ç–∫–∏
        "—Ü–µ–Ω—ã", "—Ü–µ–Ω—É", "—Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ",  # –ú–æ—Ä—Ñ–æ–ª–æ–≥–∏—è
        "–∫–∞—Ä—Ç—ã", "–∫–∞—Ä—Ç–æ—á–∫–∏", "–ø–ª–∞—Å—Ç–∏–∫–∏",  # –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —á–∏—Å–ª–æ
    ]
    
    print(f"–¢–µ—Å—Ç–∏—Ä—É–µ–º {len(test_queries)} —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:")
    print()
    
    success_count = 0
    total_confidence = 0
    
    for i, query in enumerate(test_queries, 1):
        print(f"{i:2d}. –ó–∞–ø—Ä–æ—Å: '{query}'")
        
        try:
            response = requests.post(
                f"{base_url}/chat",
                json={
                    "text": query,
                    "user_id": "test_user",
                    "locale": "ru"
                },
                timeout=10
            )
            
            if response.status_code == 200:
                data = response.json()
                confidence = data.get('confidence', 0)
                source = data.get('source', 'unknown')
                
                # –°—á–∏—Ç–∞–µ–º —É—Å–ø–µ—à–Ω—ã–º –µ—Å–ª–∏ confidence > 0.7
                if confidence > 0.7:
                    print(f"    ‚úÖ –ù–ê–ô–î–ï–ù–û! –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: {confidence:.2f}, –ò—Å—Ç–æ—á–Ω–∏–∫: {source}")
                    success_count += 1
                    total_confidence += confidence
                else:
                    print(f"    ‚ö†Ô∏è  –ù–ò–ó–ö–ê–Ø –£–í–ï–†–ï–ù–ù–û–°–¢–¨: {confidence:.2f}, –ò—Å—Ç–æ—á–Ω–∏–∫: {source}")
            else:
                print(f"    ‚ùå –û–®–ò–ë–ö–ê API: {response.status_code}")
                
        except Exception as e:
            print(f"    ‚ùå –û–®–ò–ë–ö–ê: {e}")
        
        print()
    
    success_rate = (success_count / len(test_queries)) * 100
    avg_confidence = total_confidence / success_count if success_count > 0 else 0
    
    print("üìä –§–ò–ù–ê–õ–¨–ù–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´:")
    print(f"–£—Å–ø–µ—à–Ω–æ –Ω–∞–π–¥–µ–Ω–æ: {success_count}/{len(test_queries)} ({success_rate:.1f}%)")
    print(f"–°—Ä–µ–¥–Ω—è—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: {avg_confidence:.2f}")
    
    if success_rate >= 95:
        print("üéâ –ù–ï–í–ï–†–û–Ø–¢–ù–û! –£–ª—å—Ç—Ä–∞-–ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –ø–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ!")
        print("üöÄ –ü–æ–∏—Å–∫ –ø–æ–Ω–∏–º–∞–µ—Ç –í–°–ï —Ñ–æ—Ä–º—ã —Å–ª–æ–≤, –æ–ø–µ—á–∞—Ç–∫–∏ –∏ —Å–∏–Ω–æ–Ω–∏–º—ã!")
    elif success_rate >= 90:
        print("üöÄ –ü–†–ï–í–û–°–•–û–î–ù–û! –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –ø–æ–∏—Å–∫–∞!")
        print("‚ú® –ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–Ω–∏–º–∞–µ—Ç –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—é –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç!")
    elif success_rate >= 80:
        print("‚úÖ –û–¢–õ–ò–ß–ù–û! –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è!")
        print("üîç –ü–æ–∏—Å–∫ —Å—Ç–∞–ª –Ω–∞–º–Ω–æ–≥–æ —Ç–æ—á–Ω–µ–µ!")
    else:
        print("‚ùå –ù—É–∂–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è!")
    
    return success_rate, avg_confidence

if __name__ == "__main__":
    test_ultra_advanced_search()
