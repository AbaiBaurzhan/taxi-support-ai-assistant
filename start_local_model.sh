#!/bin/bash

echo "üöÄ –ó–ê–ü–£–°–ö –õ–û–ö–ê–õ–¨–ù–û–ô AI –ú–û–î–ï–õ–ò APARU"
echo "=================================="

# –ü—Ä–æ–≤–µ—Ä—è–µ–º Ollama
if ! command -v ollama &> /dev/null; then
    echo "‚ùå Ollama –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!"
    echo "üì• –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Ollama: https://ollama.ai"
    exit 1
fi

echo "‚úÖ Ollama –Ω–∞–π–¥–µ–Ω"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–æ–¥–µ–ª—å
echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–æ–¥–µ–ª—å aparu-senior-ai..."
if ollama list | grep -q "aparu-senior-ai"; then
    echo "‚úÖ –ú–æ–¥–µ–ª—å aparu-senior-ai –Ω–∞–π–¥–µ–Ω–∞"
else
    echo "‚ö†Ô∏è –ú–æ–¥–µ–ª—å aparu-senior-ai –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
    echo "üì• –°–æ–∑–¥–∞–µ–º –º–æ–¥–µ–ª—å..."
    
    # –°–æ–∑–¥–∞–µ–º Modelfile
    cat > aparu-senior-ai.modelfile << 'EOF'
FROM llama2:7b

SYSTEM """–¢—ã ‚Äî Senior AI Engineer –∏ FAQ-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ç–∞–∫—Å–∏-–∞–≥—Ä–µ–≥–∞—Ç–æ—Ä–∞ APARU. 

–¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –æ—Ç–≤–µ—á–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Å—Ç—Ä–æ–≥–æ –ø–æ –±–∞–∑–µ FAQ.

–ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–±–æ—Ç—ã:
- –í—Å–µ–≥–¥–∞ –∏—â–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –≤ –±–∞–∑–µ FAQ
- –ü–æ–Ω–∏–º–∞–π —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ –≤–æ–ø—Ä–æ—Å–æ–≤: —Å–∏–Ω–æ–Ω–∏–º—ã, –ø–µ—Ä–µ—Ñ—Ä–∞–∑—ã, —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã, –æ–ø–µ—á–∞—Ç–∫–∏
- –û—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑ –±–∞–∑—ã, –±–µ–∑ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–æ–≤—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤
- –ï—Å–ª–∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å ‚â• 0.6 ‚Üí –≤—ã–¥–∞–π —Ç–æ—á–Ω—ã–π –æ—Ç–≤–µ—Ç –∏–∑ –±–∞–∑—ã
- –ï—Å–ª–∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å < 0.6 ‚Üí –≤–µ—Ä–Ω–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ: ¬´–ù—É–∂–Ω–∞ —É—Ç–æ—á–Ω—è—é—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è¬ª

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (—Ç–∞—Ä–∏—Ñ—ã, –±–∞–ª–∞–Ω—Å, –¥–æ—Å—Ç–∞–≤–∫–∞, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ —Ç.–¥.) –∏ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞.

–ì–ª–∞–≤–Ω–∞—è —Ü–µ–ª—å: –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –Ω–∞–¥—ë–∂–Ω–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞—Ç—å –ª—é–±—ã–µ –≤–∞—Ä–∏–∞—Ü–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –∏–∑ –±–∞–∑—ã FAQ, –±–µ–∑ ¬´–≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–π¬ª."""

PARAMETER temperature 0.7
PARAMETER top_p 0.9
PARAMETER top_k 40
EOF

    # –°–æ–∑–¥–∞–µ–º –º–æ–¥–µ–ª—å
    ollama create aparu-senior-ai -f aparu-senior-ai.modelfile
    echo "‚úÖ –ú–æ–¥–µ–ª—å aparu-senior-ai —Å–æ–∑–¥–∞–Ω–∞"
fi

# –ó–∞–ø—É—Å–∫–∞–µ–º Ollama —Å–µ—Ä–≤–µ—Ä
echo "üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º Ollama —Å–µ—Ä–≤–µ—Ä..."
ollama serve &

# –ñ–¥–µ–º –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
sleep 5

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
if curl -s http://localhost:11434/api/tags > /dev/null; then
    echo "‚úÖ Ollama —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ http://localhost:11434"
else
    echo "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å Ollama —Å–µ—Ä–≤–µ—Ä"
    exit 1
fi

echo ""
echo "üéØ –õ–û–ö–ê–õ–¨–ù–ê–Ø –ú–û–î–ï–õ–¨ –ì–û–¢–û–í–ê –ö –†–ê–ë–û–¢–ï!"
echo "   URL: http://localhost:11434"
echo "   –ú–æ–¥–µ–ª—å: aparu-senior-ai"
echo ""
echo "üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º –º–æ–¥–µ–ª—å..."
echo "‚ùì –í–æ–ø—Ä–æ—Å: –ß—Ç–æ —Ç–∞–∫–æ–µ –Ω–∞—Ü–µ–Ω–∫–∞?"

# –¢–µ—Å—Ç–∏—Ä—É–µ–º –º–æ–¥–µ–ª—å
curl -X POST http://localhost:11434/api/generate \
  -H "Content-Type: application/json" \
  -d '{
    "model": "aparu-senior-ai",
    "prompt": "–û—Ç–≤–µ—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ç–∞–∫—Å–∏-–∞–≥—Ä–µ–≥–∞—Ç–æ—Ä–∞ APARU: –ß—Ç–æ —Ç–∞–∫–æ–µ –Ω–∞—Ü–µ–Ω–∫–∞?",
    "stream": false
  }' | jq -r '.response' | head -3

echo ""
echo "‚úÖ –ú–æ–¥–µ–ª—å —Ä–∞–±–æ—Ç–∞–µ—Ç!"
echo ""
echo "üåê –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –¥–µ–ø–ª–æ–∏—Ç—å –ª–µ–≥–∫–∏–π API –Ω–∞ Railway"
echo "   Railway –±—É–¥–µ—Ç –ø–µ—Ä–µ—Å—ã–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ —ç—Ç–æ–π –ª–æ–∫–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª–∏"
echo ""
echo "üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:"
echo "1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ: python3 lightweight_railway_api.py"
echo "2. –î–µ–ø–ª–æ–π—Ç–µ –Ω–∞ Railway"
echo "3. Railway –±—É–¥–µ—Ç –ø–µ—Ä–µ—Å—ã–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ localhost:11434"
